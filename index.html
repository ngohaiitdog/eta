<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
</head>
<style>
    * {
        box-sizing: border-box;
    }
    .heading {
        text-decoration: underline;
	    font-size: 1.3em;
        margin-bottom: 0;
        margin-top: 0;
    }

    div {
        font-size: 1.3em;
        font-family: 'Arial' , '微軟正黑體';
        padding-bottom: 0;
        padding-top: 0;
		margin-bottom: 0;
		margin-top: 0;
    }
	
	.centreblock {
        width: 65%;
        overflow: auto;
        float: left;
	}

	.leftblock {
		left: 5px;
        overflow: auto;
        width: 35%;
        float: left;
	}

	.header {
		left: 5px;
		border-style: solid;
        overflow: auto;
        width: 100%;
        float: left;
	}

    .dest {
	    font-size: 0.9em;
    }

    .remark {
	    font-size: 0.9em;
    }



	button {
		top: 5px;
	}
	
    body {
        word-break: keep-all;
        width: 360px;
        overflow: auto;
        font-size: 100%;
    }


</style>
<body onload="getMTRData('LHP');getMTRData('NOP');getMTRData('TKO')">
    <span class="material-icons">Schedule</span>
    <div class="header" id="warning-message">
        abc
    </div>
    <div class="leftblock" id="trainfromLOHAS">
        <table>
            <tr>
                <td><div class="heading">康城站</div></td>
            </tr>
            <tr>
                <td><div id="nexttraintime">Test</div></td>
            </tr>
        </table>
    </div>
    <div class="centreblock" id="traintoLOHAS">
        <table style="min-width: 100%;">
            <tr>
                <td style="min-width:50%"><div class="heading">北角站</div></td>
                <td style="min-width:50%"><div class="heading">將軍澳站</div></td>
            </tr>
            <tr>
                <td><div id="fromNP">time from NP</div></td>
                <td style="vertical-align: top"><div id="fromTKO">time from TKO</div></td>
            </tr>
        </table>
    </div>
    <div class="leftblock" id="busatTKOtunnel" style="width: 100%">
        <table style="min-width: 100%;">
            <tr>
                <td><div class="heading">將隧往康城</div></td>
            </tr>
            <tr>
                <td><div id="TKOtunneltoLOHAS">Test</div></td>
            </tr>
        </table>
    </div>
    <div class="leftblock" id="busatLOHAS" style="width: 100%">
        <table style="min-width: 100%;">
            <tr>
                <td><div class="heading">康城往將隧</div></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td><div id="LOHAStoTKOtunnel">Test</div></td>
                <td> -> </td>
                <td><div id="TKOtunneltoHKI"></div></td>
            </tr>
        </table>
    </div>
    <div class="leftblock" id="busatLOHAS" style="width: 100%">
        <table style="min-width: 100%;">
            <tr>
                <td><div class="heading">New</div></td>
            </tr>
            <tr>
                <td><div id="TKOtunneltoLOHAS">Test</div></td>
            </tr>
        </table>
    </div>

    <script language="JavaScript">

        var elementidarr = ['TKOtunneltoLOHAS','LOHAStoTKOtunnel','TKOtunneltoHKI'];
        var elementarr = [[],[],[]];

        getBustime('KMB','97D1981DE7ECBCE7','98',0,'','1');
        getBustime('NWFB','003595', '797', 0);
        getBustime('KMB','07142A6203E50A47','98',1,'','1');
        getBustime('NWFB','002928', '797', 1, 'O');
        getBustime('KMB', '5BEC0CCDD7EE4A8C', '690', 2, '','1');
        getBustime('KMB', '5BEC0CCDD7EE4A8C', '690', 2, '','2');
        getBustime('CTB', '003589', '690', 2);
        

		function getMTRData(sta){
            
	        var i;
	        var d;
	        var s = "";
	        var s1 = "";
            var deststring;
            var dest;
            var m, m1, d1;
	        var objvar;
	        let request = new XMLHttpRequest();
            var timestr;
            
            request.open('GET', ('https://rt.data.gov.hk/v1/transport/mtr/getSchedule.php?line=TKL&sta=' + sta));
            request.responseType = 'json';
            request.onload = function() {
                const rawdata = request.response;

                if (rawdata['status'] == 1){
                    if (sta == 'LHP') {
                        objvar = rawdata['data']['TKL-LHP']['DOWN'];
                    } else if (sta == 'NOP') {
                        objvar = rawdata['data']['TKL-NOP']['UP'];
                    } else if (sta == 'TKO') {
                        objvar = rawdata['data']['TKL-TKO']['UP'];
                    }


                    for (i = 0; i < (objvar.length); i++){
                        timestr = objvar[i]['time']
                        timestr = timestr.substr(11,5)
                        dest = objvar[i]['dest']
                        switch (dest) {
                            case 'NOP':
                                deststring = '北角';
                                break;
                            case 'QUB':
                                deststring = '鰂魚涌';
                                break;
                            case 'YAT':
                                deststring = '油塘';
                                break;
                            case 'TIK':
                                deststring = '調景嶺';
                                break;
                            case 'TKO':
                                deststring = '將軍澳';
                                break;
                            case 'LHP':
                                deststring = '康城';
                                break;
                            case 'HAH':
                                deststring = '坑口';
                                break;
                            case 'POA':
                                deststring = '寶琳';
                        }
                                    
                        if (((sta == 'TKO') && (dest == 'LHP')) || (sta != 'TKO')) {
                            s = s + '<tr><td style="vertical-align: top"><div class="time">' + timestr + '   ' + '</div></td><td><div class="dest">' + deststring + '</div></td></tr>';
                        }

                        
                    }
                    
                    s = '<table>' + s + '</table>';
                    if (sta == 'LHP') {	    
                        document.getElementById('nexttraintime').innerHTML = s;
                    } else if (sta == 'NOP') {
                        document.getElementById('fromNP').innerHTML = s;
                    } else if (sta == 'TKO') {
                        document.getElementById('fromTKO').innerHTML = s;
                    };
                    document.getElementById('warning-message').style.display='none';
                    document.getElementById('traintoLOHAS').style.display='block';
                    document.getElementById('trainfromLOHAS').style.display='block';
                } else {
                    document.getElementById('warning-message').innerText = rawdata['message'];
                    document.getElementById('warning-message').style.display='block';
                    document.getElementById('traintoLOHAS').style.display='none';
                    document.getElementById('trainfromLOHAS').style.display='none';
                }
			
            };
	        request.send();

        };


        function getBustime(buscompany,stopid,routeid,elementid,direction,servicevariant){
            let reqstring;
            let request = new XMLHttpRequest();
            let timestr, timeobj;
            let returnarr = [];
            let objvar;
            let i;

            if (buscompany == 'KMB') {
                reqstring = 'https://data.etabus.gov.hk/v1/transport/kmb/eta/' + stopid + '/' + routeid + '/' + servicevariant;
            } else {
                reqstring = 'https://rt.data.gov.hk/v1/transport/citybus-nwfb/eta/' + buscompany + '/' + stopid + '/' + routeid;
            }
            
            request.open('GET', reqstring);
            request.responseType = 'json';
            request.onload = function() {    
                const rawdata = request.response;

                objvar = rawdata['data']
                for (i = 0; i < (objvar.length); i++){
                    timestr = objvar[i]['eta'];
                    if (typeof timestr != 'string') {
                        timestr = 'NANANANANANANANANA';
                    }
                    timeobj = new Date(timestr);
                    if ((direction === undefined) || (direction == "")) {
                        returnarr.push({route:objvar[i]['route'], time:timeobj, dest:objvar[i]['dest_tc'], remark:objvar[i]['rmk_tc'], timestr:timestr});
                    } else {
                        if (objvar[i]['dir'] == direction) {
                            returnarr.push({route:objvar[i]['route'], time:timeobj, dest:objvar[i]['dest_tc'], remark:objvar[i]['rmk_tc'], timestr:timestr});
                        }
                    }
                }

                updateElement(elementid,returnarr);
                
                return returnarr;
                
            };
            request.send();

        }

        



        function updateElement(elementid,returnarr){
            let outputstr = "";
            elementarr[elementid] = elementarr[elementid].concat(returnarr);

            
            elementarr[elementid].sort(function(a,b){return a.time - b.time});

            for (i = 0; i < elementarr[elementid].length; i++){
                if (elementarr[elementid][i].remark == '最後班次') {
                    elementarr[elementid][i].remark = '<span class="material-icons">Schedule</span>';
                }
                outputstr = outputstr + '<tr><td style="vertical-align: top"><div class="route">' + elementarr[elementid][i].route + '&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top"><div class="time">' + elementarr[elementid][i].timestr.substr(11,5) + ' ' + '</div></td><td><div class="remark">' + elementarr[elementid][i].remark + '</td></tr>';
            }
            outputstr = '<table>' + outputstr + '</table>';
            document.getElementById(elementidarr[elementid]).innerHTML = outputstr;
        }

        /*
        function getBusData(direction){
            var alltime = [];
            var timestr;
            var objvar;
            var i;
            var outputstr = "";
            let request = new XMLHttpRequest();
            let request1 = new XMLHttpRequest();
            let request2 = new XMLHttpRequest();
            var timeobj;
            
      
            if (direction == 'toLOHAS') {
                request.open('GET', ('https://data.etabus.gov.hk/v1/transport/kmb/eta/97D1981DE7ECBCE7/98/1'));
                //request.open('GET', ('https://data.etabus.gov.hk/v1/transport/kmb/eta/5238463F47B490D6/N260/1'));
            } else if (direction == '690') {
                request.open('GET', ('https://data.etabus.gov.hk/v1/transport/kmb/eta/5BEC0CCDD7EE4A8C/690/1'));
            } else {
                request.open('GET', ('https://data.etabus.gov.hk/v1/transport/kmb/eta/07142A6203E50A47/98/1'));
                //request.open('GET', ('https://data.etabus.gov.hk/v1/transport/kmb/eta/5238463F47B490D6/N260/1'));
            }

            // 07142A6203E50A47 領都 98
            request.responseType = 'json';
            request.onload = function() {    
                const rawdata = request.response;

                objvar = rawdata['data']
                for (i = 0; i < (objvar.length); i++){
                    timestr = objvar[i]['eta'];
                    if (typeof timestr != 'string') {
                        timestr = 'NANANANANANANANANA';
                    }
                    timeobj = new Date(timestr);
                    alltime.push({route:objvar[i]['route'], time:timeobj, dest:objvar[i]['dest_tc'], remark:objvar[i]['rmk_tc'], timestr:timestr});
                }
                
                if ((request.readyState == 4) && (request1.readyState == 4) && ((direction != '690') || (request2.readyState == 4))) {
                    alltime.sort(function(a,b){return a.time - b.time});

                    for (i = 0; i < alltime.length; i++){
                        outputstr = outputstr + '<tr><td style="vertical-align: top"><div class="route">' + alltime[i].route + '&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top"><div class="time">' + alltime[i].timestr.substr(11,5) + ' ' + '</div></td><td><div class="remark">' + alltime[i].remark + '</td></tr>';
                    }

                
                    outputstr = '<table>' + outputstr + '</table>';
                    if (direction == 'toLOHAS') {
                        document.getElementById("busatTKOtunneltime").innerHTML = outputstr;
                    } else if (direction == 'fromLOHAS') {
                        document.getElementById("busatLOHAStime").innerHTML = outputstr;
                    } else if (direction == '690') {
                        document.getElementById("time690").innerHTML = outputstr;
                    }
                }

                
                
            };
            request.send();

            
            if (direction == 'toLOHAS') {
                request1.open('GET', ('https://rt.data.gov.hk/v1/transport/citybus-nwfb/eta/NWFB/003595/797'));
                //request1.open('GET', ('https://rt.data.gov.hk/v1/transport/citybus-nwfb/eta/CTB/002161/N72'));
            } else if (direction == '690') {
                request1.open('GET', ('https://rt.data.gov.hk/v1/transport/citybus-nwfb/eta/CTB/003589/690'));
            } else {
                request1.open('GET', ('https://rt.data.gov.hk/v1/transport/citybus-nwfb/eta/NWFB/002928/797'));
                //request1.open('GET', ('https://rt.data.gov.hk/v1/transport/citybus-nwfb/eta/CTB/002161/N72'));
            }
            // 002928 領都 797
            request1.responseType = 'json';
            request1.onload = function() {    
                const rawdata = request1.response;

                objvar = rawdata['data']
                for (i = 0; i < (objvar.length); i++){
                    if (((direction == 'fromLOHAS') && (objvar[i]['dir'] == 'O')) || (direction != 'fromLOHAS')) {
                        timestr = objvar[i]['eta'];
                        if (typeof timestr != 'string') {
                            timestr = 'NANANANANANANANANA';
                        }
                        timeobj = new Date(timestr);
                        alltime.push({route:objvar[i]['route'], time:timeobj, dest:objvar[i]['dest_tc'], remark:objvar[i]['rmk_tc'], timestr:timestr});
                    }
                }
                

                

                

                if ((request.readyState == 4) && (request1.readyState == 4) && ((direction != '690') || (request2.readyState == 4))) {
                    alltime.sort(function(a,b){return a.time - b.time});

                    for (i = 0; i < alltime.length; i++){
                        outputstr = outputstr + '<tr><td style="vertical-align: top"><div class="route">' + alltime[i].route + '&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top"><div class="time">' + alltime[i].timestr.substr(11,5) + ' ' + '</div></td><td><div class="remark">' + alltime[i].remark + '</td></tr>';
                    }

                
                    outputstr = '<table>' + outputstr + '</table>';
                    if (direction == 'toLOHAS') {
                        document.getElementById("busatTKOtunneltime").innerHTML = outputstr;
                    } else if (direction == 'fromLOHAS') {
                        document.getElementById("busatLOHAStime").innerHTML = outputstr;
                    } else if (direction == '690') {
                        document.getElementById("time690").innerHTML = outputstr;
                    }
                }

                
            };
            request1.send();

            if (direction == '690') {
                request2.open('GET', ('https://data.etabus.gov.hk/v1/transport/kmb/eta/5BEC0CCDD7EE4A8C/690/2'));
                //request2.open('GET', ('https://data.etabus.gov.hk/v1/transport/kmb/eta/6D4E7B9D5F9584E7/N269/1'));
            
                request2.responseType = 'json';
                request2.onload = function() {    
                    const rawdata = request2.response;

                    objvar = rawdata['data']
                    for (i = 0; i < (objvar.length); i++){
                        timestr = objvar[i]['eta'];
                        if (typeof timestr != 'string') {
                            timestr = 'NANANANANANANANANA';
                        }
                        timeobj = new Date(timestr);
                        alltime.push({route:objvar[i]['route'], time:timeobj, dest:objvar[i]['dest_tc'], remark:objvar[i]['rmk_tc'], timestr:timestr});
                    }
                    
                    if ((request.readyState == 4) && (request1.readyState == 4) && ((direction != '690') || (request2.readyState == 4))) {
                        alltime.sort(function(a,b){return a.time - b.time});

                        for (i = 0; i < alltime.length; i++){
                            outputstr = outputstr + '<tr><td style="vertical-align: top"><div class="route">' + alltime[i].route + '&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top"><div class="time">' + alltime[i].timestr.substr(11,5) + ' ' + '</div></td><td><div class="remark">' + alltime[i].remark + '</td></tr>';
                        }

                    
                        outputstr = '<table>' + outputstr + '</table>';
                        if (direction == 'toLOHAS') {
                            document.getElementById("busatTKOtunneltime").innerHTML = outputstr;
                        } else if (direction == 'fromLOHAS') {
                            document.getElementById("busatLOHAStime").innerHTML = outputstr;
                        } else if (direction == '690') {
                            document.getElementById("time690").innerHTML = outputstr;
                        }
                    }
                }
                request2.send();  
            };
            //request.send();
        }
        */
    </script>
	<div class="header">
    <p><button id="button" onclick="document.getElementById('wwww').innerText = window.innerWidth">Test</button></p>
    <p>width = <div id="wwww"></div></p>
    </div>
</body>
</head>
</html>
